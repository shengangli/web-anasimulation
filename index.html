<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <!-- Primary Meta Tags -->
    <title>ANA戦略的PPプランニングツール | 高速PP・マイル計算機 | ANA公式より簡単・便利</title>
    <meta name="title" content="ANA戦略的PPプランニングツール | 高速PP・マイル計算機 | ANA公式より簡単・便利">
    <meta name="description" content="ANA（全日空）のプレミアムポイント（PP）とマイルを瞬時に計算！ANA公式サイトより遥かに高速で使いやすい無料ツール。運賃1-13完全対応、搭乗ポイント自動計算、PP効率分析で時間を大幅短縮。AMCステータス達成を効率的にサポート。">
    <meta name="keywords" content="ANA, 全日空, プレミアムポイント, PP計算, マイル計算, AMC, ステータス, ブロンズ, プラチナ, ダイヤモンド, PP修行, 運賃, 搭乗ポイント, 高速計算, 便利ツール, ANA公式より簡単, 時間短縮">
    <meta name="author" content="ANA戦略的PPプランニングツール">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Japanese">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://anasimulator.com/">
    <meta property="og:title" content="ANA戦略的PPプランニングツール | 高速PP・マイル計算機 | ANA公式より簡単・便利">
    <meta property="og:description" content="ANA（全日空）のプレミアムポイント（PP）とマイルを瞬時に計算！ANA公式サイトより遥かに高速で使いやすい無料ツール。運賃1-13完全対応、搭乗ポイント自動計算、PP効率分析で時間を大幅短縮。">
    <meta property="og:image" content="https://anasimulator.com/og-image.jpg">
    <meta property="og:site_name" content="ANA戦略的PPプランニングツール">
    <meta property="og:locale" content="ja_JP">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://anasimulator.com/">
    <meta property="twitter:title" content="ANA戦略的PPプランニングツール | 高速PP・マイル計算機 | ANA公式より簡単・便利">
    <meta property="twitter:description" content="ANA（全日空）のプレミアムポイント（PP）とマイルを瞬時に計算！ANA公式サイトより遥かに高速で使いやすい無料ツール。運賃1-13完全対応、搭乗ポイント自動計算、PP効率分析で時間を大幅短縮。">
    <meta property="twitter:image" content="https://anasimulator.com/twitter-image.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://anasimulator.com/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon/android-chrome-512x512.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "ANA戦略的PPプランニングツール",
        "alternateName": "ANAプレミアムポイント高速計算機",
        "description": "ANA（全日空）のプレミアムポイント（PP）とマイルを瞬時に計算できる無料ツール。ANA公式サイトより遥かに高速で使いやすく、運賃1-13完全対応、搭乗ポイント自動計算、PP効率分析で時間を大幅短縮。",
        "url": "https://ana-pp-calculator.com/",
        "applicationCategory": "TravelApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "JPY"
        },
        "featureList": [
            "高速プレミアムポイント（PP）計算",
            "瞬時マイル計算",
            "運賃1-13完全対応",
            "搭乗ポイント自動計算",
            "PP効率分析",
            "AMCステータス進捗表示",
            "複数フライト一括処理",
            "国内線・国際線対応",
            "ANA公式より高速・便利"
        ],
        "about": {
            "@type": "Thing",
            "name": "ANA マイレージクラブ",
            "description": "全日空（ANA）のマイレージプログラム"
        },
        "creator": {
            "@type": "Organization",
            "name": "ANA戦略的PPプランニングツール"
        },
        "dateModified": "2025-06-20",
        "inLanguage": "ja"
    }
    </script>
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#00234B">
    <meta name="msapplication-TileColor" content="#00234B">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ANA PP高速計算機">
    <meta name="format-detection" content="telephone=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ana-primary: #00234B;
            --ana-secondary: #005BAC;
            --ana-light-blue: #E6F2FF;
            --ana-red: #E60012;
            --ana-green: #00A651;
            --ana-orange: #FF6B00;
            --ana-gray: #666666;
            --ana-light-gray: #F5F5F5;
            --ana-border: #DDDDDD;
            --ana-text: #333333;
        }

        body {
            font-family: "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--ana-text);
            background: #FFFFFF;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--ana-primary);
            height: 70px;
            position: relative;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
        }

        /* Navigation */
        .navigation {
            background: var(--ana-secondary);
            height: 44px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .nav-item {
            padding: 0 20px;
            height: 100%;
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
            font-size: 14px;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-item.active {
            border-bottom-color: white;
            background: rgba(255,255,255,0.1);
        }

        /* Main Content */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 200px);
        }

        .page-title {
            font-size: 22px;
            color: var(--ana-primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--ana-secondary);
        }

        /* Sections */
        .section {
            background: white;
            border: 1px solid var(--ana-border);
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border-radius: 8px;
        }

        .section-header {
            background: var(--ana-light-gray);
            padding: 15px 20px;
            border-bottom: 1px solid var(--ana-border);
            font-weight: bold;
            color: var(--ana-primary);
            border-radius: 8px 8px 0 0;
            font-size: 15px;
        }

        .section-content {
            padding: 20px;
        }

        /* Forms */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        /* Airport row and price row styling */
        .airport-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .price-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .form-group {
            flex: 1;
            min-width: 0;
        }

        .form-group.small {
            flex: 0.7;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--ana-text);
            font-size: 13px;
            height: 18px; /* Fixed height for consistent alignment */
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--ana-border);
            background: white;
            font-size: 14px;
            color: var(--ana-text);
            border-radius: 4px;
            height: 40px;
            line-height: 1.5;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin-bottom: 5px; /* Space for small text */
        }

        .form-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 20px;
            padding-right: 35px;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--ana-secondary);
            box-shadow: 0 0 0 2px rgba(0, 91, 172, 0.1);
        }

        /* Airport optgroup styling */
        .form-select optgroup {
            font-weight: bold;
            color: var(--ana-primary);
            background-color: var(--ana-light-gray);
            font-size: 13px;
        }

        .form-select optgroup option {
            font-weight: normal;
            color: var(--ana-text);
            background-color: white;
            padding-left: 20px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            font-weight: bold;
            border-radius: 4px;
            text-align: center;
        }

        .btn-primary {
            background: var(--ana-secondary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--ana-primary);
        }

        .btn-add {
            background: var(--ana-light-blue);
            color: var(--ana-secondary);
            padding: 8px 16px;
            font-size: 13px;
            display: block;
            margin: 15px auto 0;
            width: fit-content;
        }

        .btn-add:hover {
            background: #CCE5FF;
        }

        .btn-remove {
            background: #fff5f5;
            color: var(--ana-red);
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #fecaca;
        }

        .btn-remove:hover {
            background: #fef2f2;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Flight Calculator Enhancements */
        .flight-entry {
            border: 1px solid var(--ana-border);
            padding: 18px;
            margin-bottom: 15px;
            background: var(--ana-light-gray);
            border-radius: 8px;
        }

        .flight-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .flight-number {
            font-weight: bold;
            color: var(--ana-primary);
            font-size: 15px;
        }

        .route-type-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }

        .route-domestic {
            background: var(--ana-green);
            color: white;
        }

        .route-international {
            background: var(--ana-orange);
            color: white;
        }

        /* Enhanced Results */
        .results-dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .results-main {
            background: var(--ana-light-blue);
            border: 2px solid var(--ana-secondary);
            padding: 20px;
            border-radius: 8px;
        }

        .results-summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--ana-border);
        }

        .results-title {
            font-size: 18px;
            color: var(--ana-primary);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .results-grid.no-price {
            grid-template-columns: 1fr;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border: 1px solid var(--ana-border);
            border-radius: 6px;
        }

        .result-label {
            color: var(--ana-gray);
            font-size: 13px;
        }

        .result-value {
            font-weight: bold;
            color: var(--ana-primary);
            font-size: 16px;
        }

        .result-highlight {
            grid-column: 1 / -1;
            background: var(--ana-primary);
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 6px;
        }

        .result-highlight .result-value {
            color: white;
            font-size: 20px;
        }

        /* Efficiency Indicators */
        .efficiency-meter {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .efficiency-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin: 0 10px;
            position: relative;
            overflow: hidden;
        }

        .efficiency-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .efficiency-excellent { background: var(--ana-green); }
        .efficiency-good { background: var(--ana-secondary); }
        .efficiency-average { background: var(--ana-orange); }
        .efficiency-poor { background: var(--ana-red); }

        /* Status Progress Ring */
        .status-progress {
            text-align: center;
            margin-bottom: 20px;
        }

        .progress-ring {
            width: 100px;
            height: 100px;
            margin: 0 auto 10px;
        }

        /* Quick Templates */
        .template-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .template-btn {
            padding: 8px 16px;
            background: var(--ana-light-gray);
            color: var(--ana-text);
            border: 1px solid var(--ana-border);
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        .template-btn:hover {
            background: var(--ana-light-blue);
            border-color: var(--ana-secondary);
        }

        /* Notice Box */
        .notice {
            background: #FFF9E6;
            border: 1px solid #FFD700;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--ana-text);
            border-radius: 6px;
            line-height: 1.6;
        }

        .notice-testing {
            background: #FFF2E6;
            border: 1px solid #FF9900;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--ana-text);
            border-radius: 6px;
            line-height: 1.6;
        }

        .notice-icon {
            color: #FF9900;
            margin-right: 5px;
        }

        /* Button Container */
        .button-container {
            text-align: center;
            margin: 30px 0;
        }

        .button-container .btn {
            margin: 0 10px 10px 0;
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            body {
                font-size: 13px;
            }

            /* Header adjustments */
            .header {
                height: 60px;
            }

            .header-content {
                padding: 0 15px;
            }

            .logo {
                font-size: 14px;
            }

            .logo svg {
                width: 28px;
                height: 28px;
            }

            /* Navigation */
            .navigation {
                height: 40px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .navigation::-webkit-scrollbar {
                display: none;
            }

            .nav-content {
                padding: 0 10px;
                min-width: fit-content;
            }

            .nav-item {
                padding: 8px 15px;
                font-size: 13px;
                white-space: nowrap;
                height: 40px;
            }

            /* Main content */
            .main-container {
                padding: 15px;
                min-height: calc(100vh - 140px);
            }

            .page-title {
                font-size: 18px;
                margin-bottom: 15px;
            }

            /* Better mobile form organization */
            .form-row {
                margin-bottom: 15px;
            }

            /* Airport row - keep airports side by side on mobile */
            .airport-row {
                display: flex;
                gap: 10px;
                margin-bottom: 12px;
            }

            .airport-row .form-group {
                flex: 1;
            }

            /* Booking class - full width */
            .form-row:not(.airport-row):not(.price-row) {
                display: block;
            }

            /* Price row - side by side on mobile */
            .price-row {
                display: flex;
                gap: 10px;
                align-items: flex-start;
            }

            .price-row .form-group {
                flex: 1;
            }

            .price-row .form-group.small {
                flex: 0.6;
                min-width: 120px;
            }

            .form-group {
                margin-bottom: 0;
            }

            .form-group.small {
                flex: 0.6;
            }

            .form-label {
                font-size: 12px;
                margin-bottom: 4px;
                font-weight: 600;
            }

            .form-input,
            .form-select {
                font-size: 16px; /* Prevent zoom on iOS */
                padding: 10px 12px;
                height: 44px;
            }

            .form-select {
                padding-right: 40px;
            }

            /* Sections */
            .section {
                margin-bottom: 15px;
                border-radius: 6px;
            }

            .section-header {
                padding: 12px 15px;
                font-size: 14px;
            }

            .section-content {
                padding: 15px;
            }

            /* Flight entries */
            .flight-entry {
                padding: 15px;
                margin-bottom: 12px;
                border-radius: 6px;
            }

            .flight-entry-header {
                margin-bottom: 12px;
                align-items: center;
                gap: 10px;
            }

            .flight-number {
                font-size: 14px;
                flex: 1;
            }

            /* Buttons */
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                width: 100%;
                margin-bottom: 10px;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .btn-add {
                width: auto;
                margin: 15px auto 0;
                padding: 10px 20px;
                height: auto;
            }

            .btn-remove {
                padding: 8px 12px;
                font-size: 11px;
                width: auto;
                height: auto;
                margin-bottom: 0;
            }

            /* Template buttons */
            .template-buttons {
                flex-direction: column;
                gap: 8px;
                margin-bottom: 15px;
            }

            .template-btn {
                padding: 10px 16px;
                font-size: 13px;
                flex: none;
                min-width: 0;
                height: 40px;
                border-radius: 6px;
            }

            /* Results */
            .results-dashboard {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .results-main,
            .results-summary {
                padding: 15px;
            }

            .results-title {
                font-size: 16px;
                margin-bottom: 12px;
            }

            .results-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .result-item {
                padding: 12px;
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
                min-height: auto;
            }

            .result-label {
                font-size: 11px;
                color: var(--ana-gray);
            }

            .result-value {
                font-size: 16px;
                margin-top: 2px;
            }

            .result-highlight {
                padding: 15px;
            }

            .result-highlight .result-value {
                font-size: 18px;
            }

            /* Efficiency meter */
            .efficiency-meter {
                margin: 12px 0;
                font-size: 11px;
            }

            .efficiency-bar {
                height: 6px;
                margin: 0 8px;
            }

            /* Status progress */
            .status-progress {
                margin-bottom: 15px;
            }

            .progress-ring {
                width: 80px;
                height: 80px;
            }

            /* Notice */
            .notice, .notice-testing {
                padding: 12px;
                font-size: 12px;
                margin-bottom: 15px;
                line-height: 1.5;
            }

            /* Button container */
            .button-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                margin: 20px 0;
            }

            .button-container .btn {
                width: 100%;
                max-width: 320px;
                margin: 0;
            }

            /* Advanced options */
            #advanced-options {
                margin-top: 10px;
                padding: 12px;
            }
        }

        /* Extra small devices - Stack airports vertically if very narrow */
        @media (max-width: 480px) {
            .header {
                height: 55px;
            }

            .logo span {
                font-size: 13px;
            }

            .logo svg {
                width: 24px;
                height: 24px;
            }

            .nav-item {
                padding: 8px 12px;
                font-size: 12px;
            }

            .page-title {
                font-size: 16px;
            }

            .main-container {
                padding: 12px;
            }

            .section-content {
                padding: 12px;
            }

            .flight-entry {
                padding: 12px;
            }

            .results-main,
            .results-summary {
                padding: 12px;
            }

            .template-btn {
                padding: 8px 12px;
                font-size: 12px;
                height: 36px;
            }

            /* Stack airports vertically on very small screens */
            .airport-row {
                flex-direction: column;
                gap: 12px;
            }

            /* Keep price row side by side even on very small screens */
            .price-row {
                flex-direction: row;
                gap: 8px;
            }

            .price-row .form-group.small {
                min-width: 110px;
            }
        }

        /* Touch-friendly adjustments */
        @media (hover: none) and (pointer: coarse) {
            .btn,
            .form-input,
            .form-select,
            .nav-item,
            .template-btn {
                min-height: 44px;
            }
        }

        /* Prevent horizontal scroll */
        html, body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        .main-container,
        .header-content,
        .nav-content {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <a href="#" class="logo" aria-label="ANA戦略的PPプランニングツール ホーム">
                <svg width="32" height="32" viewBox="0 0 40 40" fill="white" aria-hidden="true">
                    <circle cx="20" cy="20" r="18" stroke="white" stroke-width="2" fill="none"/>
                    <text x="50%" y="50%" text-anchor="middle" dy=".3em" fill="white" font-size="12" font-weight="bold">ANA</text>
                </svg>
                <span>戦略的PPプランニングツール</span>
            </a>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navigation" role="navigation" aria-label="メインナビゲーション">
        <div class="nav-content">
            <button class="nav-item active" onclick="switchTab('trip-calculator')" aria-current="page">旅行計算機</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container" role="main">
        <!-- Breadcrumbs -->
        <nav aria-label="パンくずリスト" style="margin-bottom: 10px;">
            <ol style="list-style: none; padding: 0; margin: 0; font-size: 12px; color: var(--ana-gray);">
                <li style="display: inline;"><a href="#" style="color: var(--ana-gray); text-decoration: none;">ホーム</a> &gt; </li>
                <li style="display: inline; color: var(--ana-primary);">ANA PP・マイル高速計算機</li>
            </ol>
        </nav>
        
        <!-- Trip Calculator Tab -->
        <article id="trip-calculator" class="tab-content active">
            <header>
                <h1 class="page-title">🚀 ANA旅行計算機 - ANA公式より高速で便利なPP・マイル計算</h1>
                <p style="font-size: 14px; color: var(--ana-gray); margin-bottom: 20px;">
                    <strong>⚡ ANA公式サイトより圧倒的に高速！</strong> プレミアムポイント（PP）とマイルを瞬時に計算。運賃1-13完全対応、搭乗ポイント自動計算、PP効率分析で時間を大幅短縮。AMCステータス達成の最短ルートを見つけよう。
                </p>
            </header>
            
            <section class="notice-testing" role="region" aria-labelledby="testing-notice">
                <h2 id="testing-notice" style="display: none;">テスト版に関する注意事項</h2>
                <span class="notice-icon" aria-hidden="true">🧪</span>
                <strong>【テスト版】計算精度について:</strong> このツールは現在テスト段階のため、計算データの一部に不正確な部分がある可能性があります。
                <br>• 距離データ・積算率・搭乗ポイントなどの検証を継続中
                <br>• より正確な計算アルゴリズムを開発中
                <br>• <strong>重要なPP・マイル計算は必ずANA公式サイトで最終確認をお願いします</strong>
                <br>• フィードバックや不具合報告をお待ちしています（下部のお問い合わせフォームより）
            </section>

            <section class="notice" role="region" aria-labelledby="important-notice">
                <h2 id="important-notice" style="display: none;">使用上の注意事項</h2>
                <span class="notice-icon" aria-hidden="true">⚠️</span>
                <strong>使用上の注意事項:</strong> この計算機は概算シミュレーション用です。
                <br>• 距離データ: 大圏距離の近似値を使用（ANA公式距離ではありません）
                <br>• PP計算: ANA公式の計算式（距離×積算率×路線倍率+搭乗ポイント）に基づき、搭乗ポイントも含めて計算
                <br>• 搭乗ポイント: 運賃1-3,5=400pt、運賃6=200pt、運賃4,7-13=0pt（ANA公式データに基づく）
                <br>• マイル計算: ANA公式の積算率に基づいていますが、実際の積算と異なる場合があります
            </section>

            <!-- Quick Templates -->
            <section class="template-buttons" role="region" aria-labelledby="quick-templates">
                <h2 id="quick-templates" style="display: none;">クイックテンプレート</h2>
                <button class="template-btn" onclick="loadTemplate('business')" aria-label="出張パターンを読み込む">📊 出張パターン</button>
                <button class="template-btn" onclick="loadTemplate('leisure')" aria-label="休暇旅行パターンを読み込む">🏖️ 休暇旅行</button>
                <button class="template-btn" onclick="loadTemplate('pp-run')" aria-label="PP修行パターンを読み込む">🏃 PP修行</button>
                <button class="template-btn" onclick="loadTemplate('international')" aria-label="国際線パターンを読み込む">✈️ 国際線</button>
            </section>

            <section class="section">
                <header class="section-header">
                    <h2>フライト詳細入力</h2>
                </header>
                <div class="section-content">
                    <div id="flights-container">
                        <!-- First Flight Entry -->
                        <div class="flight-entry">
                            <div class="flight-entry-header">
                                <span class="flight-number">フライト 1</span>
                                <button class="btn btn-remove" onclick="removeFlight(this)">削除</button>
                            </div>
                            <div class="form-row airport-row">
                                <div class="form-group">
                                    <label class="form-label">出発空港</label>
                                    <select class="form-select from-airport" onchange="updateRouteInfo(this)">
                                        <option value="">出発空港を選択...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">到着空港</label>
                                    <select class="form-select to-airport" onchange="updateRouteInfo(this)">
                                        <option value="">到着空港を選択...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label booking-class-label">予約クラス</label>
                                    <select class="form-select booking-class">
                                        <option value="">まず空港を選択してください</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row price-row">
                                <div class="form-group">
                                    <label class="form-label">1区間チケット価格 (税込) - オプション</label>
                                    <input type="number" class="form-input ticket-price" placeholder="価格を入力するとPP効率も計算されます" min="0">
                                    <small style="color: var(--ana-gray); font-size: 11px;">円 (片道価格) - 空白でもPP・マイル計算可能</small>
                                </div>
                                <div class="form-group small">
                                    <label class="form-label">往復・複数区間</label>
                                    <select class="form-select trip-multiplier">
                                        <option value="1">片道 (1区間)</option>
                                        <option value="2">往復 (2区間)</option>
                                        <option value="3">3区間</option>
                                        <option value="4">4区間</option>
                                        <option value="5">5区間</option>
                                        <option value="6">6区間以上</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-add" onclick="addFlight()">+ フライトを追加</button>
                </div>
            </div>

            <section class="section">
                <header class="section-header">
                    <h2>基本設定</h2>
                </header>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">現在のAMCステータス</label>
                            <select class="form-select" id="current-status">
                                <option value="none">AMCメンバー</option>
                                <option value="bronze">ブロンズサービス (+30%)</option>
                                <option value="platinum">プラチナサービス (+50%)</option>
                                <option value="diamond">ダイヤモンドサービス (+100%)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Advanced Options (Collapsible) -->
                    <div style="margin-top: 20px;">
                        <button type="button" class="btn" style="background: var(--ana-light-gray); color: var(--ana-text); font-size: 13px; padding: 8px 16px;" onclick="toggleAdvancedOptions()">
                            <span id="advanced-toggle">▶</span> 詳細オプション
                        </button>
                        <div id="advanced-options" style="display: none; margin-top: 15px; padding: 15px; background: var(--ana-light-gray); border-radius: 6px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">現在のPP残高 (オプション)</label>
                                    <input type="number" class="form-input" id="current-pp" placeholder="0" value="0">
                                    <small style="color: var(--ana-gray); font-size: 11px;">ステータス進捗計算に使用</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="button-container" role="region" aria-labelledby="calculation-controls">
                <h2 id="calculation-controls" style="display: none;">計算実行</h2>
                <button class="btn btn-primary" onclick="calculateTrip()" aria-describedby="calculation-description">
                    ⚡ 高速分析を実行
                </button>
                <p id="calculation-description" style="display: none;">フライト情報を基にプレミアムポイントとマイルを計算します</p>
                <button class="btn" onclick="testCalculation()" style="background: var(--ana-light-gray); color: var(--ana-text);" aria-label="計算機能をテスト">
                    🔧 テスト
                </button>
            </div>

            <section id="trip-results" style="display: none;" role="region" aria-labelledby="results-title" aria-live="polite">
                <div class="results-dashboard">
                    <div class="results-main">
                        <h2 class="results-title">📈 トリップ分析結果</h2>
                        <div class="results-grid">
                            <div class="result-item">
                                <span class="result-label">獲得PP</span>
                                <span class="result-value" id="total-pp">0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">獲得マイル</span>
                                <span class="result-value" id="total-miles">0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">総費用</span>
                                <span class="result-value" id="total-cost">¥0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">PP効率</span>
                                <span class="result-value" id="pp-efficiency">0 PP/¥1000</span>
                            </div>
                            <div class="result-highlight">
                                <span class="result-label">コストパフォーマンス評価</span>
                                <div class="efficiency-meter">
                                    <span style="font-size: 12px;">低効率</span>
                                    <div class="efficiency-bar">
                                        <div class="efficiency-fill" id="efficiency-bar"></div>
                                    </div>
                                    <span style="font-size: 12px;">高効率</span>
                                </div>
                                <div id="efficiency-rating" style="margin-top: 10px; font-weight: bold;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="results-summary">
                        <h3 class="results-title">🎯 ステータス進捗</h3>
                        <div class="status-progress">
                            <div class="progress-ring">
                                <svg width="100" height="100" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="transparent"/>
                                    <circle cx="50" cy="50" r="40" stroke="var(--ana-secondary)" stroke-width="8" fill="transparent"
                                            stroke-dasharray="251.2" stroke-dashoffset="251.2" id="progress-circle"
                                            style="transition: stroke-dashoffset 0.5s ease;"/>
                                    <text x="50" y="50" text-anchor="middle" dy="0.3em" font-size="14" font-weight="bold" fill="var(--ana-primary)" id="progress-percent">0%</text>
                                </svg>
                            </div>
                            <div id="status-text">次のステータスまで</div>
                        </div>
                        <div id="status-recommendations">
                            <!-- Dynamic recommendations will be inserted here -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- FAQ Section for SEO -->
            <section class="section" style="margin-top: 40px;">
                <header class="section-header">
                    <h2>よくある質問（FAQ）</h2>
                </header>
                <div class="section-content">
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--ana-primary); font-size: 14px; margin-bottom: 8px;">Q: このツールはANA公式サイトとどう違いますか？</h3>
                        <p style="font-size: 13px; line-height: 1.5; margin-bottom: 15px;">A: ANA公式サイトでは1区間ずつしか計算できず時間がかかりますが、当ツールでは複数フライトを一括で瞬時に計算。PP効率分析やステータス進捗も同時に表示し、圧倒的に高速で便利です。</p>
                        
                        <h3 style="color: var(--ana-primary); font-size: 14px; margin-bottom: 8px;">Q: プレミアムポイント（PP）とは何ですか？</h3>
                        <p style="font-size: 13px; line-height: 1.5; margin-bottom: 15px;">A: ANAマイレージクラブのステータス獲得に必要なポイントです。フライトマイルとは別に積算され、ブロンズ（30,000PP）、プラチナ（50,000PP）、ダイヤモンド（100,000PP）の達成に使用されます。</p>
                        
                        <h3 style="color: var(--ana-primary); font-size: 14px; margin-bottom: 8px;">Q: 搭乗ポイントとは何ですか？</h3>
                        <p style="font-size: 13px; line-height: 1.5; margin-bottom: 15px;">A: 国内線の特定運賃で獲得できる追加ポイントです。運賃1-3,5で400ポイント、運賃6で200ポイント、その他は0ポイントが付与されます。</p>
                        
                        <h3 style="color: var(--ana-primary); font-size: 14px; margin-bottom: 8px;">Q: 運賃1-13とは何ですか？</h3>
                        <p style="font-size: 13px; line-height: 1.5; margin-bottom: 15px;">A: ANAの国内線運賃種別番号です。運賃1がプレミアム運賃（150%）、運賃7がSUPER VALUE（75%）など、それぞれ異なる積算率と搭乗ポイントが設定されています。</p>
                        
                        <h3 style="color: var(--ana-primary); font-size: 14px; margin-bottom: 8px;">Q: PP効率とは何ですか？</h3>
                        <p style="font-size: 13px; line-height: 1.5;">A: 1,000円あたりに獲得できるプレミアムポイント数です。PP修行では重要な指標で、高い効率のルートを選ぶことでコストを抑えてステータスを達成できます。</p>
                    </div>
                </div>
            </section>
        </article>
    </main>

    <!-- Footer -->
    <footer style="background: var(--ana-light-gray); border-top: 1px solid var(--ana-border); margin-top: 40px; padding: 30px 20px 20px;">
        <div style="max-width: 1400px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 20px;">
                <div>
                    <h3 style="color: var(--ana-primary); font-size: 16px; margin-bottom: 15px;">ANA戦略的PPプランニングツールについて</h3>
                    <p style="font-size: 13px; line-height: 1.5; color: var(--ana-gray);">
                        ANA（全日空）のプレミアムポイントとマイルを<strong>ANA公式サイトより圧倒的に高速</strong>で正確に計算できる無料ツールです。複数フライト一括計算、PP効率分析、ステータス進捗表示で時間を大幅短縮し、AMCステータス達成を効率的にサポートします。
                    </p>
                </div>
                <div>
                    <h3 style="color: var(--ana-primary); font-size: 16px; margin-bottom: 15px;">対応機能</h3>
                    <ul style="list-style: none; padding: 0; font-size: 13px; line-height: 1.7; color: var(--ana-gray);">
                        <li>⚡ ANA公式より高速計算</li>
                        <li>✈️ 国内線・国際線PP計算</li>
                        <li>🎯 運賃1-13完全対応</li>
                        <li>📊 搭乗ポイント自動計算</li>
                        <li>💰 PP効率分析</li>
                        <li>📈 ステータス進捗表示</li>
                        <li>🏃 PP修行プランニング</li>
                        <li>🔄 複数フライト一括処理</li>
                    </ul>
                </div>
                <div>
                    <h3 style="color: var(--ana-primary); font-size: 16px; margin-bottom: 15px;">お問い合わせ・フィードバック</h3>
                    <p style="font-size: 13px; line-height: 1.5; color: var(--ana-gray); margin-bottom: 15px;">
                        計算結果の不具合報告、機能改善のご提案、ご質問など、お気軽にお寄せください。
                    </p>
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLSefkeAmPPZgZyHH-jye_hxon_VE1wa744wqnUEZ52qBd9WwRw/viewform?usp=dialog" style="display: inline-block; background: var(--ana-secondary); color: white; padding: 8px 16px; border-radius: 4px; text-decoration: none; font-size: 13px; font-weight: bold;">
                        📧 お問い合わせフォーム
                    </a>
                    <div style="margin-top: 10px;">
                        <h4 style="color: var(--ana-primary); font-size: 14px; margin-bottom: 8px;">関連キーワード</h4>
                        <div style="font-size: 12px; line-height: 1.5; color: var(--ana-gray);">
                            <span style="display: inline-block; background: white; padding: 4px 8px; margin: 2px; border-radius: 12px; border: 1px solid var(--ana-border);">ANA PP高速計算</span>
                            <span style="display: inline-block; background: white; padding: 4px 8px; margin: 2px; border-radius: 12px; border: 1px solid var(--ana-border);">マイル瞬時計算</span>
                            <span style="display: inline-block; background: white; padding: 4px 8px; margin: 2px; border-radius: 12px; border: 1px solid var(--ana-border);">AMCステータス</span>
                            <span style="display: inline-block; background: white; padding: 4px 8px; margin: 2px; border-radius: 12px; border: 1px solid var(--ana-border);">PP修行効率化</span>
                            <span style="display: inline-block; background: white; padding: 4px 8px; margin: 2px; border-radius: 12px; border: 1px solid var(--ana-border);">公式より便利</span>
                            <span style="display: inline-block; background: white; padding: 4px 8px; margin: 2px; border-radius: 12px; border: 1px solid var(--ana-border);">時間短縮ツール</span>
                        </div>
                    </div>
                </div>
            </div>
            <div style="border-top: 1px solid var(--ana-border); padding-top: 20px; text-align: center; font-size: 12px; color: var(--ana-gray);">
                <p>© 2025 ANA戦略的PPプランニングツール. このツールはANA（全日空）の公式ツールではありません。</p>
                <p><strong>ANA公式サイトより高速・便利</strong>ですが、正確な情報は必ずANA公式サイトでご確認ください。</p>
            </div>
        </div>
    </footer>

    <!-- Contact Form Modal (Hidden by default) -->
    <div id="contact-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h3 style="color: var(--ana-primary); margin-bottom: 20px;">お問い合わせ・フィードバック</h3>
            <form id="contact-form" onsubmit="submitContactForm(event)">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">お問い合わせ種別</label>
                    <select style="width: 100%; padding: 8px; border: 1px solid var(--ana-border); border-radius: 4px;">
                        <option value="bug">計算結果の不具合報告</option>
                        <option value="feature">機能改善・追加要望</option>
                        <option value="question">使い方に関する質問</option>
                        <option value="other">その他</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">メールアドレス（オプション）</label>
                    <input type="email" style="width: 100%; padding: 8px; border: 1px solid var(--ana-border); border-radius: 4px;" placeholder="返信をご希望の場合はご入力ください">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">内容</label>
                    <textarea style="width: 100%; padding: 8px; border: 1px solid var(--ana-border); border-radius: 4px; height: 120px; resize: vertical;" placeholder="詳細をお聞かせください。不具合の場合は、使用したルートや設定もお教えいただけると助かります。" required></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" onclick="closeContactForm()" style="padding: 10px 20px; background: var(--ana-light-gray); color: var(--ana-text); border: 1px solid var(--ana-border); border-radius: 4px; cursor: pointer;">キャンセル</button>
                    <button type="submit" style="padding: 10px 20px; background: var(--ana-secondary); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">送信</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Enhanced route distances based on IATA TPM data
        const routeDistances = {
            // Major International Routes from Japan
            'NRT-LAX': 5451, 'NRT-JFK': 6737, 'NRT-LHR': 5956, 'NRT-SIN': 3312, 'NRT-SYD': 4863, 'NRT-FRA': 5928,
            'NRT-CDG': 6012, 'NRT-AMS': 5863, 'NRT-MAD': 6734, 'NRT-FCO': 6125, 'NRT-ZUR': 5890, 'NRT-VIE': 5623,
            'HND-ORD': 6262, 'HND-LAX': 5440, 'HND-SFO': 5130, 'HND-SEA': 4782, 'HND-DFW': 6456, 'HND-IAH': 6804,
            'KIX-SFO': 5358, 'KIX-LAX': 5481, 'KIX-HNL': 3856, 'KIX-SIN': 3243, 'KIX-BKK': 2869, 'KIX-ICN': 540,
            'NGO-SEA': 4782, 'NGO-SFO': 5116, 'NGO-HNL': 3853, 'FUK-HNL': 3853, 'FUK-ICN': 541, 'FUK-SIN': 3312,
            'NRT-BKK': 2869, 'NRT-SFO': 5130, 'NRT-SEA': 4782, 'NRT-HKG': 1807, 'NRT-ICN': 758, 'NRT-PEK': 1313,
            'NRT-PVG': 1094, 'NRT-TPE': 1313, 'NRT-MNL': 1864, 'NRT-KUL': 3312, 'NRT-CGK': 3632, 'NRT-BOM': 4163,
            'NRT-DEL': 3665, 'NRT-DXB': 5063, 'NRT-DOH': 4953, 'NRT-IST': 5623, 'NRT-CAI': 5890, 'NRT-JNB': 8912,
            'HND-ICN': 720, 'HND-PVG': 1090, 'HND-TPE': 1310, 'HND-HKG': 1800, 'HND-SIN': 3308, 'HND-BKK': 2865,
            'KIX-HKG': 1463, 'KIX-TPE': 976, 'KIX-PVG': 754, 'KIX-PEK': 983, 'KIX-MNL': 1520, 'KIX-GUM': 1225,
            'NGO-ICN': 598, 'NGO-TPE': 1153, 'NGO-PVG': 934, 'NGO-HKG': 1647, 'NGO-GUM': 1405, 'NGO-SIN': 3152,
            'CTS-ICN': 600, 'CTS-TPE': 1353, 'CTS-HKG': 1847, 'CTS-SIN': 3352, 'CTS-BKK': 3069, 'CTS-GUM': 1605,
            'OKA-ICN': 618, 'OKA-TPE': 613, 'OKA-HKG': 881, 'OKA-SIN': 2450, 'OKA-BKK': 2167, 'OKA-MNL': 758,
            
            // Additional International Routes
            'NRT-HNL': 3853, 'HND-HNL': 3850, 'NRT-GUM': 1560, 'HND-GUM': 1555,
            'ITM-ICN': 520, 'ITM-TPE': 960, 'ITM-HKG': 1450, 'ITM-PVG': 740, 'ITM-SIN': 3220,
            'FUK-PVG': 550, 'FUK-TPE': 750, 'FUK-HKG': 1100, 'FUK-BKK': 2580, 'FUK-MNL': 1580,
            
            // Domestic routes - All major combinations
            'NRT-HND': 20, 'NRT-KIX': 280, 'NRT-ITM': 280, 'NRT-NGO': 180, 'NRT-CTS': 510, 'NRT-FUK': 565, 'NRT-OKA': 984,
            'HND-KIX': 280, 'HND-ITM': 280, 'HND-NGO': 180, 'HND-CTS': 510, 'HND-FUK': 565, 'HND-OKA': 984,
            'KIX-NGO': 120, 'KIX-CTS': 730, 'KIX-FUK': 285, 'KIX-OKA': 704, 'KIX-ITM': 20,
            'ITM-NGO': 110, 'ITM-CTS': 720, 'ITM-FUK': 280, 'ITM-OKA': 700,
            'NGO-CTS': 610, 'NGO-FUK': 405, 'NGO-OKA': 804,
            'CTS-FUK': 1175, 'CTS-OKA': 1494,
            'FUK-OKA': 419
        };

        // Airport data organized by regions
        const airportsByRegion = {
            '日本国内': {
                'NRT': '東京成田 (NRT)',
                'HND': '東京羽田 (HND)', 
                'KIX': '大阪関西 (KIX)',
                'ITM': '大阪伊丹 (ITM)',
                'NGO': '名古屋中部 (NGO)',
                'CTS': '札幌新千歳 (CTS)',
                'FUK': '福岡 (FUK)',
                'OKA': '沖縄那覇 (OKA)'
            },
            'アジア・太平洋': {
                'ICN': 'ソウル仁川 (ICN)',
                'PEK': '北京首都 (PEK)',
                'PVG': '上海浦東 (PVG)',
                'TPE': '台北桃園 (TPE)',
                'HKG': '香港 (HKG)',
                'SIN': 'シンガポール (SIN)',
                'BKK': 'バンコク (BKK)',
                'MNL': 'マニラ (MNL)',
                'SYD': 'シドニー (SYD)',
                'GUM': 'グアム (GUM)'
            },
            '北米': {
                'LAX': 'ロサンゼルス (LAX)',
                'SFO': 'サンフランシスコ (SFO)',
                'SEA': 'シアトル (SEA)',
                'JFK': 'ニューヨーク JFK (JFK)',
                'ORD': 'シカゴ オヘア (ORD)',
                'DFW': 'ダラス (DFW)',
                'IAH': 'ヒューストン (IAH)',
                'HNL': 'ホノルル (HNL)'
            },
            'ヨーロッパ': {
                'LHR': 'ロンドン ヒースロー (LHR)',
                'CDG': 'パリ CDG (CDG)',
                'FRA': 'フランクフルト (FRA)',
                'AMS': 'アムステルダム (AMS)',
                'MAD': 'マドリード (MAD)',
                'FCO': 'ローマ (FCO)',
                'ZUR': 'チューリッヒ (ZUR)',
                'VIE': 'ウィーン (VIE)',
                'IST': 'イスタンブール (IST)'
            },
            '中東・その他': {
                'DXB': 'ドバイ (DXB)',
                'DOH': 'ドーハ (DOH)',
                'BOM': 'ムンバイ (BOM)',
                'DEL': 'デリー (DEL)'
            }
        };

        // Create flat airport names lookup
        const airportNames = {};
        Object.keys(airportsByRegion).forEach(region => {
            Object.assign(airportNames, airportsByRegion[region]);
        });

        // ==========================================
        // ANA BOOKING CLASS DATA STORAGE LOCATION
        // ==========================================
        // This section contains ALL fare data used in calculations
        
        // ANA Domestic Numbered Fare System (運賃1-13) - Based on OFFICIAL ANA data
        // Source: ANA国内線利用運賃一覧表 - Exact rates and boarding points
        const domesticClassData = {
            // 運賃1-3: Premium/Full Fares (400 Boarding Points)
            '1': { rate: 1.5, name: '運賃1 プレミアム運賃 (150%) +400pt', category: 'premium', ppMultiplier: 1.5, boardingPoints: 400 },
            '2': { rate: 1.25, name: '運賃2 VALUE PREMIUM 3/株主優待 (125%) +400pt', category: 'premium', ppMultiplier: 1.25, boardingPoints: 400 },
            '3': { rate: 1.0, name: '運賃3 ANA FLEX/ビジネスきっぷ (100%) +400pt', category: 'full', ppMultiplier: 1.0, boardingPoints: 400 },
            
            // 運賃4: Special Full Fare (0 Boarding Points) - CORRECTED
            '4': { rate: 1.0, name: '運賃4 各種アイきっぷ (100%) +0pt', category: 'full', ppMultiplier: 1.0, boardingPoints: 0 },
            
            // 運賃5: VALUE Fares (400 Boarding Points) - CORRECTED  
            '5': { rate: 0.75, name: '運賃5 VALUE 1/3/7/株主優待 (75%) +400pt', category: 'value', ppMultiplier: 0.75, boardingPoints: 400 },
            
            // 運賃6: VALUE TRANSIT (200 Boarding Points)
            '6': { rate: 0.75, name: '運賃6 VALUE TRANSIT (75%) +200pt', category: 'value', ppMultiplier: 0.75, boardingPoints: 200 },
            
            // 運賃7-8: Discount Fares (0 Boarding Points)
            '7': { rate: 0.75, name: '運賃7 SUPER VALUE 21/28/45 (75%) +0pt', category: 'discount', ppMultiplier: 0.75, boardingPoints: 0 },
            '8': { rate: 0.5, name: '運賃8 スマートU25/シニア空割 (50%) +0pt', category: 'discount', ppMultiplier: 0.5, boardingPoints: 0 },
            
            // 運賃9-13: International domestic segments (0 Boarding Points)
            '9': { rate: 1.5, name: '運賃9 国際線国内区間 F/A (150%) +0pt', category: 'intl-domestic', ppMultiplier: 1.5, boardingPoints: 0 },
            '10': { rate: 1.0, name: '運賃10 国際線国内区間 Y/B/M (100%) +0pt', category: 'intl-domestic', ppMultiplier: 1.0, boardingPoints: 0 },
            '11': { rate: 0.7, name: '運賃11 国際線国内区間 U/H/Q (70%) +0pt', category: 'intl-domestic', ppMultiplier: 0.7, boardingPoints: 0 },
            '12': { rate: 0.5, name: '運賃12 国際線国内区間 V/W/S (50%) +0pt', category: 'intl-domestic', ppMultiplier: 0.5, boardingPoints: 0 },
            '13': { rate: 0.3, name: '運賃13 国際線国内区間 L/K (30%) +0pt', category: 'intl-domestic', ppMultiplier: 0.3, boardingPoints: 0 }
        };

        // ANA International Booking Classes (A-Z System) - No Boarding Points for International
        const internationalClassData = {
            // Economy Classes
            'Y': { rate: 1.0, name: 'Y (エコノミー・普通運賃 100%)', category: 'economy', ppMultiplier: 1.0, boardingPoints: 0 },
            'B': { rate: 0.7, name: 'B (エコノミー・割引運賃 70%)', category: 'economy', ppMultiplier: 0.7, boardingPoints: 0 },
            'M': { rate: 0.7, name: 'M (エコノミー・割引運賃 70%)', category: 'economy', ppMultiplier: 0.7, boardingPoints: 0 },
            'U': { rate: 0.5, name: 'U (エコノミー・格安運賃 50%)', category: 'economy', ppMultiplier: 0.5, boardingPoints: 0 },
            'H': { rate: 0.5, name: 'H (エコノミー・格安運賃 50%)', category: 'economy', ppMultiplier: 0.5, boardingPoints: 0 },
            'Q': { rate: 0.5, name: 'Q (エコノミー・格安運賃 50%)', category: 'economy', ppMultiplier: 0.5, boardingPoints: 0 },
            'V': { rate: 0.3, name: 'V (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            'W': { rate: 0.3, name: 'W (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            'S': { rate: 0.3, name: 'S (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            'T': { rate: 0.3, name: 'T (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            'L': { rate: 0.3, name: 'L (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            'G': { rate: 0.3, name: 'G (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            'K': { rate: 0.3, name: 'K (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            'E': { rate: 0.3, name: 'E (エコノミー・超格安 30%)', category: 'economy', ppMultiplier: 0.3, boardingPoints: 0 },
            
            // Premium Economy Classes
            'P': { rate: 1.3, name: 'P (プレミアムエコノミー 130%)', category: 'premium-economy', ppMultiplier: 1.3, boardingPoints: 0 },
            'O': { rate: 1.3, name: 'O (プレミアムエコノミー 130%)', category: 'premium-economy', ppMultiplier: 1.3, boardingPoints: 0 },
            'N': { rate: 1.3, name: 'N (プレミアムエコノミー 130%)', category: 'premium-economy', ppMultiplier: 1.3, boardingPoints: 0 },
            
            // Business Classes
            'J': { rate: 1.5, name: 'J (ビジネスクラス 150%)', category: 'business', ppMultiplier: 1.5, boardingPoints: 0 },
            'C': { rate: 1.5, name: 'C (ビジネスクラス 150%)', category: 'business', ppMultiplier: 1.5, boardingPoints: 0 },
            'D': { rate: 1.25, name: 'D (ビジネス・割引 125%)', category: 'business', ppMultiplier: 1.25, boardingPoints: 0 },
            'I': { rate: 1.25, name: 'I (ビジネス・割引 125%)', category: 'business', ppMultiplier: 1.25, boardingPoints: 0 },
            'Z': { rate: 1.25, name: 'Z (ビジネス・割引 125%)', category: 'business', ppMultiplier: 1.25, boardingPoints: 0 },
            
            // First Class
            'F': { rate: 2.0, name: 'F (ファーストクラス 200%)', category: 'first', ppMultiplier: 2.0, boardingPoints: 0 },
            'A': { rate: 2.0, name: 'A (ファーストクラス 200%)', category: 'first', ppMultiplier: 2.0, boardingPoints: 0 }
        };

        // Status bonus rates (for miles earning)
        const statusBonus = {
            'none': 0, 'bronze': 0.3, 'platinum': 0.5, 'diamond': 1.0
        };

        // Route ratio for Premium Points calculation
        const routeRatio = {
            'domestic': 2.0,           // Japan domestic = 2x
            'asia': 1.5,              // Japan-Asia = 1.5x  
            'international': 1.0       // Other international = 1x
        };

        let flightCounter = 1;

        // Contact form functions
        function openContactForm() {
            document.getElementById('contact-modal').style.display = 'flex';
        }

        function closeContactForm() {
            document.getElementById('contact-modal').style.display = 'none';
        }

        function submitContactForm(event) {
            event.preventDefault();
            alert('お問い合わせありがとうございます。送信機能は現在準備中です。しばらくお待ちください。');
            closeContactForm();
        }

        // Test function
        function testCalculation() {
            console.log('Test calculation function called');
            alert('計算ボタンが正常に動作しています！出発・到着空港と予約クラスを選択してから「高速分析を実行」をクリックしてください。');
        }

        // Toggle advanced options
        function toggleAdvancedOptions() {
            const options = document.getElementById('advanced-options');
            const toggle = document.getElementById('advanced-toggle');
            
            if (options.style.display === 'none') {
                options.style.display = 'block';
                toggle.textContent = '▼';
            } else {
                options.style.display = 'none';
                toggle.textContent = '▶';
            }
        }

        // Initialize airports with regional grouping
        function initializeAirports() {
            const selects = document.querySelectorAll('.from-airport, .to-airport');
            
            selects.forEach(select => {
                const isFrom = select.classList.contains('from-airport');
                select.innerHTML = isFrom ? '<option value="">出発空港を選択...</option>' : '<option value="">到着空港を選択...</option>';
                
                // Add airports by region
                Object.keys(airportsByRegion).forEach(regionName => {
                    const airports = airportsByRegion[regionName];
                    
                    // Add region header
                    const regionOption = document.createElement('optgroup');
                    regionOption.label = regionName;
                    select.appendChild(regionOption);
                    
                    // Add airports in this region
                    Object.keys(airports).forEach(code => {
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = airports[code];
                        regionOption.appendChild(option);
                    });
                });
            });
        }

        // Template loading
        function loadTemplate(type) {
            const container = document.getElementById('flights-container');
            container.innerHTML = '';
            flightCounter = 0;

            const templates = {
                business: [
                    { from: 'HND', to: 'ICN', class: 'J', price: 180000 },
                    { from: 'ICN', to: 'HND', class: 'J', price: 180000 }
                ],
                leisure: [
                    { from: 'NRT', to: 'HNL', class: 'Y', price: 85000 }
                ],
                'pp-run': [
                    { from: 'HND', to: 'OKA', class: '5', price: 30000 },
                    { from: 'OKA', to: 'HND', class: '5', price: 30000 }
                ],
                international: [
                    { from: 'NRT', to: 'LAX', class: 'W', price: 280000 }
                ]
            };

            templates[type].forEach(flight => {
                addFlight();
                const lastFlight = container.lastElementChild;
                lastFlight.querySelector('.from-airport').value = flight.from;
                lastFlight.querySelector('.to-airport').value = flight.to;
                updateRouteInfo(lastFlight.querySelector('.from-airport'));
                lastFlight.querySelector('.booking-class').value = flight.class;
                lastFlight.querySelector('.ticket-price').value = flight.price;
            });
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Flight management
        function addFlight() {
            flightCounter++;
            const container = document.getElementById('flights-container');
            const newFlight = document.createElement('div');
            newFlight.className = 'flight-entry';
            newFlight.innerHTML = `
                <div class="flight-entry-header">
                    <span class="flight-number">フライト ${flightCounter}</span>
                    <button class="btn btn-remove" onclick="removeFlight(this)">削除</button>
                </div>
                <div class="form-row airport-row">
                    <div class="form-group">
                        <label class="form-label">出発空港</label>
                        <select class="form-select from-airport" onchange="updateRouteInfo(this)">
                            <option value="">出発空港を選択...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">到着空港</label>
                        <select class="form-select to-airport" onchange="updateRouteInfo(this)">
                            <option value="">到着空港を選択...</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label booking-class-label">予約クラス</label>
                        <select class="form-select booking-class">
                            <option value="">まず空港を選択してください</option>
                        </select>
                    </div>
                </div>
                <div class="form-row price-row">
                    <div class="form-group">
                        <label class="form-label">1区間チケット価格 (税込) - オプション</label>
                        <input type="number" class="form-input ticket-price" placeholder="価格を入力するとPP効率も計算されます" min="0">
                        <small style="color: var(--ana-gray); font-size: 11px;">円 (片道価格) - 空白でもPP・マイル計算可能</small>
                    </div>
                    <div class="form-group small">
                        <label class="form-label">往復・複数区間</label>
                        <select class="form-select trip-multiplier">
                            <option value="1">片道 (1区間)</option>
                            <option value="2">往復 (2区間)</option>
                            <option value="3">3区間</option>
                            <option value="4">4区間</option>
                            <option value="5">5区間</option>
                            <option value="6">6区間以上</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(newFlight);
            
            // Initialize airport dropdowns with regional grouping
            const fromSelect = newFlight.querySelector('.from-airport');
            const toSelect = newFlight.querySelector('.to-airport');
            
            [fromSelect, toSelect].forEach(select => {
                // Add airports by region
                Object.keys(airportsByRegion).forEach(regionName => {
                    const airports = airportsByRegion[regionName];
                    
                    // Add region header
                    const regionOption = document.createElement('optgroup');
                    regionOption.label = regionName;
                    select.appendChild(regionOption);
                    
                    // Add airports in this region
                    Object.keys(airports).forEach(code => {
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = airports[code];
                        regionOption.appendChild(option);
                    });
                });
            });
        }

        function removeFlight(button) {
            button.closest('.flight-entry').remove();
        }

        // Route information update
        function updateRouteInfo(select) {
            const flight = select.closest('.flight-entry');
            const from = flight.querySelector('.from-airport').value;
            const to = flight.querySelector('.to-airport').value;
            const classSelect = flight.querySelector('.booking-class');
            const classLabel = flight.querySelector('.booking-class-label');
            
            if (from && to) {
                const routeType = isInternational(from, to) ? 'international' : 'domestic';
                
                // Update booking class label
                if (routeType === 'domestic') {
                    classLabel.textContent = '予約クラス (運賃タイプ)';
                } else {
                    classLabel.textContent = '予約クラス (Booking Class)';
                }
                
                // Update booking class options based on route type
                updateBookingClassOptions(classSelect, routeType);
            } else {
                classSelect.innerHTML = '<option value="">まず空港を選択してください</option>';
                classLabel.textContent = '予約クラス';
            }
        }

        // Update booking class options based on route type
        function updateBookingClassOptions(select, routeType) {
            const currentValue = select.value;
            select.innerHTML = '';
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = '予約クラスを選択...';
            select.appendChild(defaultOption);
            
            // Choose the appropriate class data based on route type
            const classData = routeType === 'domestic' ? domesticClassData : internationalClassData;
            
            // Group classes by category
            const categories = {};
            
            if (routeType === 'domestic') {
                // Domestic numbered fare system (運賃1-13) with boarding points - CORRECTED
                categories.premium = { name: '--- プレミアム運賃 (400pt) ---', classes: [] };
                categories.full = { name: '--- 普通運賃 (400pt/0pt) ---', classes: [] };
                categories.value = { name: '--- VALUE運賃 (400pt/200pt) ---', classes: [] };
                categories.discount = { name: '--- 割引運賃 (0pt) ---', classes: [] };
                categories['intl-domestic'] = { name: '--- 国際線国内区間 (0pt) ---', classes: [] };
            } else {
                categories.economy = { name: '--- エコノミークラス ---', classes: [] };
                categories['premium-economy'] = { name: '--- プレミアムエコノミー ---', classes: [] };
                categories.business = { name: '--- ビジネスクラス ---', classes: [] };
                categories.first = { name: '--- ファーストクラス ---', classes: [] };
            }
            
            // Group classes
            Object.keys(classData).forEach(classCode => {
                const classInfo = classData[classCode];
                
                if (categories[classInfo.category]) {
                    categories[classInfo.category].classes.push({
                        code: classCode,
                        name: classInfo.name,
                        rate: classInfo.rate
                    });
                }
            });
            
            // Add options to select
            Object.keys(categories).forEach(categoryKey => {
                const category = categories[categoryKey];
                if (category.classes.length > 0) {
                    // Add class options grouped
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = category.name;
                    select.appendChild(optgroup);
                    
                    // Sort by rate (highest first)
                    category.classes.sort((a, b) => b.rate - a.rate);
                    
                    category.classes.forEach(classInfo => {
                        const option = document.createElement('option');
                        option.value = classInfo.code;
                        option.textContent = classInfo.name;
                        optgroup.appendChild(option);
                    });
                }
            });
            
            // Restore previous value if still valid
            if (currentValue && select.querySelector(`option[value="${currentValue}"]`)) {
                select.value = currentValue;
            }
        }

        // Utility functions
        function getDistance(from, to) {
            const route = `${from}-${to}`;
            const reverse = `${to}-${from}`;
            return routeDistances[route] || routeDistances[reverse] || 0;
        }

        function estimateDistance(from, to) {
            const domesticAirports = ['NRT', 'HND', 'KIX', 'ITM', 'NGO', 'CTS', 'FUK', 'OKA'];
            const isDomestic = domesticAirports.includes(from) && domesticAirports.includes(to);
            
            if (isDomestic) {
                if ((from === 'CTS' || to === 'CTS') && (from === 'OKA' || to === 'OKA')) return 1494;
                if (from === 'CTS' || to === 'CTS') return 700;
                if (from === 'OKA' || to === 'OKA') return 800;
                return 300;
            } else {
                const asiaAirports = ['ICN', 'PEK', 'PVG', 'TPE', 'HKG', 'SIN', 'BKK', 'MNL'];
                const europeAirports = ['LHR', 'CDG', 'FRA', 'AMS', 'MAD', 'FCO', 'ZUR', 'VIE'];
                const americasAirports = ['LAX', 'SFO', 'SEA', 'JFK', 'ORD', 'DFW', 'IAH', 'HNL'];
                
                if (asiaAirports.includes(from) || asiaAirports.includes(to)) return 2000;
                if (europeAirports.includes(from) || europeAirports.includes(to)) return 5900;
                if (americasAirports.includes(from) || americasAirports.includes(to)) return 5500;
                return 3500;
            }
        }

        function isInternational(from, to) {
            const domesticAirports = ['NRT', 'HND', 'KIX', 'ITM', 'NGO', 'CTS', 'FUK', 'OKA'];
            return !(domesticAirports.includes(from) && domesticAirports.includes(to));
        }

        function getRouteRatio(from, to) {
            if (!isInternational(from, to)) {
                return routeRatio.domestic; // 2.0 for domestic
            }
            
            const asiaAirports = ['ICN', 'PEK', 'PVG', 'TPE', 'HKG', 'SIN', 'BKK', 'MNL'];
            if (asiaAirports.includes(from) || asiaAirports.includes(to)) {
                return routeRatio.asia; // 1.5 for Asia
            }
            
            return routeRatio.international; // 1.0 for other international
        }

        // Corrected calculation functions based on ANA official system
        function calculatePP(distance, classCode, routeType, from, to) {
            const classData = routeType === 'domestic' ? domesticClassData : internationalClassData;
            const classInfo = classData[classCode];
            
            if (!classInfo) return 0;
            
            // ANA Premium Points formula: Basic segment mileage × Mileage accrual rate × Route Ratio + Boarding Points
            const routeRatioValue = getRouteRatio(from, to);
            const basePP = Math.floor(distance * classInfo.ppMultiplier * routeRatioValue);
            
            // Add boarding points (only for domestic flights, international flights don't get boarding points)
            const boardingPoints = routeType === 'domestic' ? classInfo.boardingPoints : 0;
            
            console.log(`PP Calculation: ${distance} miles × ${classInfo.ppMultiplier} rate × ${routeRatioValue} ratio + ${boardingPoints} boarding = ${basePP + boardingPoints} PP`);
            
            return basePP + boardingPoints;
        }

        function calculateMiles(distance, classCode, routeType) {
            const classData = routeType === 'domestic' ? domesticClassData : internationalClassData;
            const classInfo = classData[classCode];
            
            if (!classInfo) return 0;
            
            // ANA Miles formula: Basic sector mileage × Accrual rate for booking class
            return Math.floor(distance * classInfo.rate);
        }

        // Main calculation function
        function calculateTrip() {
            console.log('calculateTrip function called');
            
            try {
                const flights = document.querySelectorAll('.flight-entry');
                const currentStatus = document.getElementById('current-status').value;
                const currentPP = parseInt(document.getElementById('current-pp').value) || 0;
                
                console.log(`Found ${flights.length} flights`);
                console.log(`Current status: ${currentStatus}`);
                
                let totalPP = 0;
                let totalMiles = 0;
                let totalCost = 0;
                let validFlights = 0;
                let hasInvalidClass = false;

                flights.forEach((flight, index) => {
                    console.log(`Processing flight ${index + 1}`);
                    
                    const from = flight.querySelector('.from-airport').value;
                    const to = flight.querySelector('.to-airport').value;
                    const classCode = flight.querySelector('.booking-class').value;
                    const ticketPrice = parseInt(flight.querySelector('.ticket-price').value) || 0;
                    const multiplier = parseInt(flight.querySelector('.trip-multiplier').value) || 1;

                    console.log(`Flight ${index + 1}: ${from} -> ${to}, class: ${classCode}, price: ${ticketPrice || 'none'}, multiplier: ${multiplier}`);

                    if (from && to && classCode) {
                        let distance = getDistance(from, to);
                        
                        if (distance === 0) {
                            distance = estimateDistance(from, to);
                            console.log(`Using estimated distance: ${distance}`);
                        }
                        
                        console.log(`Distance: ${distance}`);
                        
                        if (distance > 0) {
                            const routeType = isInternational(from, to) ? 'international' : 'domestic';
                            console.log(`Route type: ${routeType}`);
                            
                            const classData = routeType === 'domestic' ? domesticClassData : internationalClassData;
                            
                            if (!classData[classCode]) {
                                console.log(`Invalid class code ${classCode} for ${routeType} route`);
                                hasInvalidClass = true;
                                return;
                            }
                            
                            validFlights++;
                            
                            // Calculate base PP and miles per segment
                            const basePP = calculatePP(distance, classCode, routeType, from, to);
                            const baseMiles = calculateMiles(distance, classCode, routeType);
                            
                            console.log(`Base PP: ${basePP}, Base Miles: ${baseMiles}`);
                            
                            // Apply status bonus only to miles (not PP)
                            const statusMultiplier = 1 + statusBonus[currentStatus];
                            const finalPP = basePP * multiplier; // PP doesn't get status bonus
                            const finalMiles = Math.floor(baseMiles * statusMultiplier * multiplier);
                            
                            console.log(`Final PP: ${finalPP}, Final Miles: ${finalMiles}`);
                            
                            totalPP += finalPP;
                            totalMiles += finalMiles;
                            if (ticketPrice > 0) {
                                totalCost += (ticketPrice * multiplier);
                            }
                        }
                    }
                });

                console.log(`Valid flights: ${validFlights}, Total PP: ${totalPP}, Total Cost: ${totalCost || 'No price data'}`);

                if (hasInvalidClass) {
                    alert('選択した予約クラスがこのルートタイプでは無効です。空港を再選択して予約クラスを更新してください。');
                    return;
                }

                if (validFlights === 0) {
                    alert('有効なフライトを入力してください（出発・到着空港、予約クラスを選択）');
                    return;
                }

                // Update display
                document.getElementById('total-pp').textContent = totalPP.toLocaleString();
                document.getElementById('total-miles').textContent = totalMiles.toLocaleString();
                
                // Show different results based on whether price was entered
                const resultsGrid = document.querySelector('.results-grid');
                
                if (totalCost > 0) {
                    resultsGrid.classList.remove('no-price');
                    const ppEfficiency = (totalPP / totalCost * 1000);
                    
                    document.getElementById('total-cost').textContent = `¥${totalCost.toLocaleString()}`;
                    document.getElementById('pp-efficiency').textContent = `${ppEfficiency.toFixed(1)} PP/¥1000`;
                    
                    document.querySelectorAll('.result-item').forEach(item => item.style.display = 'flex');
                    document.querySelector('.result-highlight').style.display = 'block';
                    
                    // Efficiency rating
                    let efficiencyClass, efficiencyText, efficiencyPercent;
                    if (ppEfficiency >= 20) {
                        efficiencyClass = 'efficiency-excellent';
                        efficiencyText = '🏆 極めて優秀な効率';
                        efficiencyPercent = 95;
                    } else if (ppEfficiency >= 15) {
                        efficiencyClass = 'efficiency-excellent';
                        efficiencyText = '🏆 優秀な効率';
                        efficiencyPercent = 85;
                    } else if (ppEfficiency >= 10) {
                        efficiencyClass = 'efficiency-good';
                        efficiencyText = '👍 良好な効率';
                        efficiencyPercent = 70;
                    } else if (ppEfficiency >= 5) {
                        efficiencyClass = 'efficiency-average';
                        efficiencyText = '📊 平均的な効率';
                        efficiencyPercent = 50;
                    } else {
                        efficiencyClass = 'efficiency-poor';
                        efficiencyText = '⚠️ 効率改善推奨';
                        efficiencyPercent = 25;
                    }

                    const efficiencyBar = document.getElementById('efficiency-bar');
                    const efficiencyRating = document.getElementById('efficiency-rating');
                    
                    if (efficiencyBar && efficiencyRating) {
                        efficiencyBar.className = `efficiency-fill ${efficiencyClass}`;
                        efficiencyBar.style.width = `${efficiencyPercent}%`;
                        efficiencyRating.textContent = efficiencyText;
                    }
                } else {
                    resultsGrid.classList.add('no-price');
                    document.querySelector('.result-item:nth-child(3)').style.display = 'none';
                    document.querySelector('.result-item:nth-child(4)').style.display = 'none';
                    document.querySelector('.result-highlight').style.display = 'none';
                }

                // Status progress
                updateStatusProgress(currentPP + totalPP);

                // Show results
                const resultsElement = document.getElementById('trip-results');
                if (resultsElement) {
                    resultsElement.style.display = 'block';
                    resultsElement.scrollIntoView({ behavior: 'smooth' });
                }
                
                console.log('Calculation completed successfully');
                
            } catch (error) {
                console.error('Calculation error:', error);
                alert(`計算中にエラーが発生しました: ${error.message}`);
            }
        }

        function updateStatusProgress(totalPP) {
            const thresholds = { bronze: 30000, platinum: 50000, diamond: 100000 };
            let targetStatus, targetPP, progress;

            if (totalPP < thresholds.bronze) {
                targetStatus = 'ブロンズサービス';
                targetPP = thresholds.bronze;
                progress = (totalPP / targetPP) * 100;
            } else if (totalPP < thresholds.platinum) {
                targetStatus = 'プラチナサービス';
                targetPP = thresholds.platinum;
                progress = (totalPP / targetPP) * 100;
            } else if (totalPP < thresholds.diamond) {
                targetStatus = 'ダイヤモンドサービス';
                targetPP = thresholds.diamond;
                progress = (totalPP / targetPP) * 100;
            } else {
                targetStatus = 'ダイヤモンド達成済み';
                targetPP = thresholds.diamond;
                progress = 100;
            }

            const circle = document.getElementById('progress-circle');
            const text = document.getElementById('progress-percent');
            const statusText = document.getElementById('status-text');
            
            const circumference = 251.2;
            const offset = circumference - (progress / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            text.textContent = `${Math.round(progress)}%`;
            statusText.textContent = `${targetStatus}まで ${(targetPP - totalPP).toLocaleString()} PP`;

            // Recommendations
            const recommendations = document.getElementById('status-recommendations');
            const remaining = targetPP - totalPP;
            
            if (remaining > 0) {
                // Using HND-OKA with 運賃5 (VALUE) - includes 400 boarding points per segment
                // 984 distance * 0.75 rate * 2 route ratio + 400 boarding points = 1,876 PP per segment
                // Round trip = 1,876 * 2 = 3,752 PP
                const ppPerTrip = 3752; // Much better PP efficiency with boarding points
                const costPerTrip = 60000; // VALUE fares cost more than SUPER VALUE
                recommendations.innerHTML = `
                    <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid var(--ana-border); font-size: 12px;">
                        <strong>必要PP:</strong> ${remaining.toLocaleString()} PP<br>
                        <strong>HND-OKA往復 (運賃5 VALUE)なら:</strong> 約${Math.ceil(remaining / ppPerTrip)}回<br>
                        <strong>概算費用:</strong> ¥${(Math.ceil(remaining / ppPerTrip) * costPerTrip).toLocaleString()}
                    </div>
                `;
            } else {
                recommendations.innerHTML = `
                    <div style="background: var(--ana-light-blue); padding: 12px; border-radius: 6px; font-size: 12px;">
                        🎉 おめでとうございます！<br>
                        ${targetStatus}の条件を満たしています
                    </div>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeAirports();
            
            // Close modal when clicking outside
            document.getElementById('contact-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeContactForm();
                }
            });
        });
    </script>
</body>
</html>